rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Any authenticated user can read the lists of users, tickets, and projects.
    // This is required for the dashboard and list pages to function.
    // Individual document writes are more restricted.
    match /users/{userId} {
      allow read: if request.auth != null;
      // Only the user themselves can update their profile.
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    match /tickets/{ticketId} {
      allow read: if request.auth != null;
      // Any authenticated user can create a ticket.
      allow create: if request.auth != null;
      // For other writes, we trust the server-side logic in the action files
      // to perform the necessary permission checks.
      allow update, delete: if request.auth != null;
    }
    
    match /projects/{projectId} {
      allow read: if request.auth != null;
      // For other writes, we trust the server-side logic in the action files
      // to perform the necessary permission checks.
      allow write: if request.auth != null;
    }
    
    match /notifications/{notificationId} {
       // A user can only read their own notifications.
      allow read: if request.auth != null && request.auth.uid == resource.data.userId;
       // Server actions are authenticated and handle creating notifications.
      allow write: if request.auth != null;
    }
  }
}
